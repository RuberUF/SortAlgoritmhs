<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algoritmos de Ordenamiento y Búsqueda</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'MyApp/css/styles.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <style>
        .accordion-button {
            background-color: #343a40 !important;
            color: #e0e0e0;
            border: none;
        }
        
        .accordion-button:not(.collapsed) {
            background-color: #495057 !important;
        }
        
        .accordion-button::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23e0e0e0' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 011.414 0L8 9.586l4.94-4.94a.5.5 0 11.707.707l-5.647 5.646a.5.5 0 01-.707 0L1.646 5.353a.5.5 0 010-.707z'/%3E%3C/svg%3E") !important;
        }
        
        .accordion-body {
            background-color: #2d2d2d;
        }
        
    </style>
</head>

<body class="N">
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow-sm">
            <div class="container">
                <a class="navbar-brand" href="{% url 'home' %}"><i class="fas fa-cogs"></i> Algoritmos</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Inicio</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'intereses' %}">Compresión</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'blog' %}">Blog</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'about' %}">Acerca</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main class="container my-5">
        <br>
        <section class="mb-5">
            <img src="{% static 'MyApp/images/hunter_x_hunter.png' %}" alt="Preview del Proyecto" class="img-fluid img-fixed-left">
            <div class="card p-4 shadow-lg">
                <h2 class="text-center mb-4">Algoritmos de Ordenamiento</h2>
                <div class="row g-4">
                    <div class="col-md-4">
                        <label for="dataInputFile" class="form-label fw-bold">Cargar desde archivo</label>
                        <input type="file" id="dataInputFile" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label for="dataInputText" class="form-label fw-bold">Ingresar datos manualmente</label>
                        <textarea id="dataInputText" class="form-control mb-2" rows="10" placeholder="Ingrese los datos separados por comas..."></textarea>
                        <button id="clearButton" class="btn btn-secondary w-100">Limpiar</button>
                    </div>
                    
                    
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Generar datos</label>
                        <input type="number" id="startRange" class="form-control mb-2" placeholder="Rango inicial">
                        <input type="number" id="endRange" class="form-control mb-2" placeholder="Rango final">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" id="randomData" name="dataType">
                            <label class="form-check-label" for="randomData">Aleatorios</label>
                        </div>
                        <input type="number" id="dataCount" class="form-control mb-3" placeholder="Cantidad de datos">
                        <button id="generateRandomData" class="btn btn-primary w-100">Generar Datos</button>
                    </div>
                </div>
                <div class="mt-4">
                    <h5 class="fw-bold mb-3">Opciones de Ordenamiento</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="orderType" class="form-label">Orden</label>
                            <select id="orderType" class="form-select">
                                <option value="asc">Ascendente</option>
                                <option value="desc">Descendente</option>
                            </select>
                            <button type="button" class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#filtersModal">Filtros</button>
                        </div>
                        
                        <div class="modal fade" id="filtersModal" tabindex="-1" aria-labelledby="filtersModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content bg-dark text-white">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="filtersModalLabel">Filtros</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h3>Ordenar Solo</h3>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="prime" value="prime">
                                                    <label class="form-check-label" for="prime">Primos</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="fibonacci" value="fibonacci">
                                                    <label class="form-check-label" for="fibonacci">Fibonacci</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="factorial" value="factorial">
                                                    <label class="form-check-label" for="factorial">Factorial</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="amigos" value="amigos">
                                                    <label class="form-check-label" for="amigos">Amigos</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="narcisistas" value="narcisistas">
                                                    <label class="form-check-label" for="narcisistas">Narcisistas</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="perfectos" value="perfectos">
                                                    <label class="form-check-label" for="perfectos">Perfectos</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="deficientes" value="deficientes">
                                                    <label class="form-check-label" for="deficientes">Deficientes</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="abundantes" value="abundantes">
                                                    <label class="form-check-label" for="abundantes">Abundantes</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sortFilter" id="pronic" value="pronic">
                                                    <label class="form-check-label" for="pronic">Prónicos</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <h3>Tipo de Dato</h3>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="dataType" id="soloNumeros" value="soloNumeros">
                                                    <label class="form-check-label" for="soloNumeros">Solo números</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="dataType" id="soloCadenas" value="soloCadenas">
                                                    <label class="form-check-label" for="soloCadenas">Solo cadenas</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="dataType" id="numerosYCadenas" value="numerosYCadenas">
                                                    <label class="form-check-label" for="numerosYCadenas">Números y cadenas</label>
                                                </div>
                                                <div class="text-center mt-3">
                                                    <img src="{% static 'MyApp/images/ash_render.png' %}" alt="Imagen decorativa" class="img-fluid" style="max-width: 50%;">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="button" class="btn btn-primary">Guardar Cambios</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Algoritmos</label>
                            <div class="checkbox-container">
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="selectAll" value="selectAll">
                                    <label class="form-check-label" for="selectAll">Seleccionar Todos</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="bubbleSort" value="Bubble Sort">
                                    <label class="form-check-label" for="bubbleSort">Bubble Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="quickSort" value="Quick Sort">
                                    <label class="form-check-label" for="quickSort">Quick Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="cocktailSort" value="Cocktail Sort">
                                    <label class="form-check-label" for="cocktailSort">Cocktail Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="insertionSort" value="Insertion Sort">
                                    <label class="form-check-label" for="insertionSort">Insertion Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="bucketSort" value="Bucket Sort">
                                    <label class="form-check-label" for="bucketSort">Bucket Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="countingSort" value="Counting Sort">
                                    <label class="form-check-label" for="countingSort">Counting Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="mergeSort" value="Merge Sort">
                                    <label class="form-check-label" for="mergeSort">Merge Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="binaryTreeSort" value="Binary Tree Sort">
                                    <label class="form-check-label" for="binaryTreeSort">Binary Tree Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="radixSort" value="Radix Sort">
                                    <label class="form-check-label" for="radixSort">Radix Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="shellSort" value="Shell Sort">
                                    <label class="form-check-label" for="shellSort">Shell Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="combSort" value="Comb Sort">
                                    <label class="form-check-label" for="combSort">Comb Sort</label>
                                </div>
                                <div class="checkbox-item">
                                    <input class="form-check-input" type="checkbox" id="heapSort" value="Heap Sort">
                                    <label class="form-check-label" for="heapSort">Heap Sort</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="sortButton" class="btn btn-success w-100 mt-4" name="btn1">Ordenar Datos</button>
                </div>
            </div>
        </section>
        <section class="mb-5">
            <div class="card p-4 shadow-lg">
                <h2 class="text-center mb-4">Resultados</h2>
                <div class="progress mb-4">
                    <div id="progressBar" class="progress-bar progress-bar-striped bg-success" style="width: 0%;">0%</div>
                </div>
                <div class="table-responsive">
                    <div id="resultsContainer" class="row"></div>
                </div>
                <p id="sortTime" class="mt-3">Tiempo de ordenamiento: <span>0 ms</span></p>
                <img src="{% static 'MyApp/images/anime_girl_render_14_by_nunnallyrey.png' %}" alt="Preview del Proyecto" class="img-fluid mt-4 d-block mx-auto">
                <div class="d-flex justify-content-between">
                    <button id="descargarBtn" class="btn btn-desacargar">Descargar</button>
                    <button id="verGraficaBtn" class="btn btn-grafica" data-bs-toggle="modal" data-bs-target="#graficaModal">Ver Gráfica</button>
                    <button class="btn btn-historial" data-bs-toggle="modal" data-bs-target="#historialModal">Ver Historial</button>
                </div>
            </div>
        </section>
        
        
        
        <!-- Modal para Gráfica -->
        <div class="modal fade" id="graficaModal" tabindex="-1" aria-labelledby="graficaModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="graficaModalLabel">Gráfica de Complejidad Computacional</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="graficaContainer" class="text-center">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
<div class="modal fade" id="historialModal" tabindex="-1" aria-labelledby="historialModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="historialModalLabel">
                    <img src="{% static 'MyApp/images/history_icon.png' %}" alt="Ícono de Historial" style="width: 24px; margin-right: 10px;">
                    Historial de Algoritmos
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h3>Resumen de Uso</h3>
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Algoritmo</th>
                            <th>Veces Usado</th>
                            <th>Datos Ordenados</th>
                        </tr>
                    </thead>
                    <tbody id="historialResumen">
                    </tbody>
                </table>
                <button class="btn btn-primary w-100 mt-3" id="verDetallesBtn" data-bs-toggle="modal" data-bs-target="#detallesModal">
                    Ver Más Detalles
                </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="detallesModal" tabindex="-1" aria-labelledby="detallesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="detallesModalLabel">
                    <img src="{% static 'MyApp/images/details_icon.png' %}" alt="Ícono de Detalles" style="width: 24px; margin-right: 10px;">
                    Detalles del Historial
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h3>Detalles del Uso</h3>
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Índice</th>
                            <th>Algoritmo</th>
                            <th>Datos Ordenados</th>
                            <th>Tiempo (ms)</th>
                            <th>Fecha</th>
                        </tr>
                    </thead>
                    <tbody id="historialDetalles">
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h5 class="modal-title" id="alertModalLabel">
                    <img src="{% static 'MyApp/images/anime_render.png' %}" alt="Ícono de Advertencia" style="width: 24px; margin-right: 10px;">
                    Alerta
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center" id="alertModalBody">
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
        <section class="mb-5">
            <div class="card p-4 shadow-lg">
                <h2 class="text-center mb-4">Búsqueda</h2>
                <div class="row mb-4">
                    <div class="col-md-8">
                        <input type="text" class="form-control" placeholder="Buscar Dato">
                    </div>
                    <div class="col-md-4">
                        <select id="searchType" class="form-select">
                            <option>Tipo de Busqueda</option>
                            <option>Búsqueda Lineal</option>
                            <option>Binaria</option>
                            <option>Hash</option>
                            <option>Fibonacci</option>
                            <option>DFS</option>
                            <option>BFS</option>
                            <option>Interpolacional</option>
                            <option>Ternaria</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mb-4">Buscar</button>
                
                <div class="table-responsive">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Índice</th>
                                <th>Dato</th>
                                <th>Algoritmo</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
    </main>

    <footer>
        <div class="social-icons text-center">
            <a href="https://wa.me/+51930686399" target="_blank" title="WhatsApp">
                <i class="fab fa-whatsapp fa-2x"></i>
            </a>
            <a href="https://github.com/RuberUF" target="_blank" title="GitHub">
                <i class="fab fa-github fa-2x"></i>
            </a>
            <a href="https://t.me/+51930686388" target="_blank" title="Telegram">
                <i class="fab fa-telegram fa-2x"></i>
            </a>
        </div>
        <p>&copy; 2024 Algoritmos de Ordenamiento. Todos los derechos reservados.</p>
    </footer>
    <!--No tocar mrds-->
    <!--LA IMAGEN CUANDO BAJE ABAJO NO TRASPASE EL PIE DE PAGINA , ES DECIR NO ENTRE DENTRO DEL PIE DE PAGINA SE QUEDE TOCANDO SOLO EL INCIO DEL PIE DE PAGINA-->
    <img id="ninoImage" src="{% static 'MyApp/images/nakano_nino.png' %}" alt="Nakano Nino" class="img-right-fixed">
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        const csrftoken = getCookie('csrftoken');
        const csrfTokenMeta = document.querySelector('meta[name="csrf-token"]');
        if (csrfTokenMeta) {
            const csrftoken = csrfTokenMeta.getAttribute('content');
        }
        
    </script>
    <script>
        let historial = [];
        function showAlert(message) {
            const alertModal = new bootstrap.Modal(document.getElementById('alertModal'));
            document.getElementById('alertModalBody').innerText = message;
            alertModal.show();
        }
        
        document.getElementById('sortButton').addEventListener('click', function () {
            const dataInputText = document.getElementById('dataInputText').value;
            if (!dataInputText) {
                showAlert('Por favor, ingresa algunos datos para ordenar.');
                return;
            }
        
            const data = dataInputText.split(',').map(item => parseFloat(item.trim())).filter(item => !isNaN(item));
        
            if (data.length === 0) {
                showAlert('Por favor, ingresa datos válidos separados por comas.');
                return;
            }
        
            const orderType = document.getElementById('orderType').value;
            const selectedAlgorithms = Array.from(document.querySelectorAll('input[type="checkbox"]:checked:not(#selectAll)')).map(cb => cb.value);
        
            if (selectedAlgorithms.length === 0) {
                showAlert('Por favor, selecciona al menos un algoritmo de ordenamiento.');
                return;
            }
        
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
        
            let tempResults = [];
        
            selectedAlgorithms.forEach((algorithm, index) => {
                fetch('/sort-data/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({algorithm, data, orderType})
                })
                .then(response => response.json())
                .then(result => {
                    const currentDate = new Date().toLocaleString();
                    historial.push({
                        algorithm: algorithm,
                        dataCount: data.length,
                        elapsedTime: result.elapsed_time,
                        date: currentDate
                    });
        
                    tempResults.push({algorithm, result, index});
                    tempResults.sort((a, b) => a.index - b.index);
                    
                    resultsContainer.innerHTML = '';
                    let rowDiv = null;
                    tempResults.forEach((tempResult, idx) => {
                        if (idx % 2 === 0) {
                            rowDiv = document.createElement('div');
                            rowDiv.className = 'row mb-4';
                            resultsContainer.appendChild(rowDiv);
                        }
        
                        const colClass = (idx % 2 === 0 && selectedAlgorithms.length === idx + 1) ? 'col-12' : 'col-md-6';
                        const colDiv = document.createElement('div');
                        colDiv.className = `${colClass} mb-4`;
                        colDiv.innerHTML = `
                            <div class="accordion accordion-custom" id="accordion-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}" aria-expanded="false" aria-controls="collapse-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}">
                                            ${tempResult.algorithm}
                                        </button>
                                    </h2>
                                    <div id="collapse-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}" class="accordion-collapse collapse" aria-labelledby="heading-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}" data-bs-parent="#accordion-${tempResult.algorithm.replace(/\s+/g, '')}-${idx}">
                                        <div class="accordion-body">
                                            <table class="table table-dark table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Dato Original</th>
                                                        <th>Dato Ordenado</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${tempResult.result.sorted_data.map((item, i) => `
                                                        <tr>
                                                            <td>${i + 1}</td>
                                                            <td>${data[i]}</td>
                                                            <td>${item}</td>
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                            <p class="text-center">Tiempo de ${tempResult.algorithm}: <span>${tempResult.result.elapsed_time} ms</span></p>
                                            <p class="text-center">Número de Datos: ${data.length}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        rowDiv.appendChild(colDiv);
                    });
                })
                .catch(error => console.error('Error:', error));
            });
        });
        
        document.getElementById('historialModal').addEventListener('show.bs.modal', function () {
            const historialResumen = document.getElementById('historialResumen');
        
            historialResumen.innerHTML = '';
        
            const resumen = {};
            historial.forEach(entry => {
                if (!resumen[entry.algorithm]) {
                    resumen[entry.algorithm] = { count: 0, dataCount: 0 };
                }
                resumen[entry.algorithm].count += 1;
                resumen[entry.algorithm].dataCount += entry.dataCount;
            });
        
            for (const [algorithm, data] of Object.entries(resumen)) {
                historialResumen.innerHTML += `
                    <tr>
                        <td>${algorithm}</td>
                        <td>${data.count}</td>
                        <td>${data.dataCount}</td>
                    </tr>
                `;
            }
        });
        
        document.getElementById('detallesModal').addEventListener('show.bs.modal', function () {
            const historialDetalles = document.getElementById('historialDetalles');
        
            historialDetalles.innerHTML = '';
        
            historial.forEach((entry, index) => {
                historialDetalles.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${entry.algorithm}</td>
                        <td>${entry.dataCount}</td>
                        <td>${entry.elapsedTime}</td>
                        <td>${entry.date}</td>
                    </tr>
                `;
            });
        });
        
        document.getElementById('generateRandomData').addEventListener('click', function () {
            const startRange = parseInt(document.getElementById('startRange').value);
            const endRange = parseInt(document.getElementById('endRange').value);
            const dataCount = parseInt(document.getElementById('dataCount').value);
        
            if (isNaN(startRange) || isNaN(endRange) || isNaN(dataCount)) {
                showAlert('Por favor, ingresa valores válidos para el rango y la cantidad de datos.');
                return;
            }
        
            fetch('/generate-random-data/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({startRange, endRange, dataCount})
            })
            .then(response => response.json())
            .then(result => {
                document.getElementById('dataInputText').value = result.data.join(', ');
            })
            .catch(error => console.error('Error:', error));
        });
        
        document.getElementById('dataInputFile').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;
        
            const formData = new FormData();
            formData.append('file', file);
        
            fetch('/read-data/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken
                },
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                document.getElementById('dataInputText').value = result.data.join(', ');
            })
            .catch(error => console.error('Error:', error));
        });
        
        document.getElementById('selectAll').addEventListener('change', function () {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:not(#selectAll)');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });
        
        document.getElementById('clearButton').addEventListener('click', function () { 
            document.getElementById('dataInputText').value = '';
        });
        
        
    </script>
    <script>
        document.getElementById('verGraficaBtn').addEventListener('click', function () {
            const selectedAlgorithms = Array.from(document.querySelectorAll('input[type="checkbox"]:checked:not(#selectAll)')).map(cb => cb.value);
            
            if (selectedAlgorithms.length === 0) {
                showAlert('Por favor, selecciona al menos un algoritmo de ordenamiento.');
                return;
            }
        
            const tiempos = selectedAlgorithms.map(algorithm => {
                return historial.filter(entry => entry.algorithm === algorithm).map(entry => entry.elapsedTime);
            });
        
            fetch('/grafica/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({algoritmos: selectedAlgorithms, tiempos: tiempos})
            })
            .then(response => response.json())
            .then(data => {
                const image = new Image();
                image.src = `data:image/png;base64,${data.image_base64}`;
                document.getElementById('graficaContainer').innerHTML = '';
                document.getElementById('graficaContainer').appendChild(image);
            })
            .catch(error => console.error('Error:', error));
        });
        
    </script>
    <script>
        document.getElementById('descargarBtn').addEventListener('click', function () {
        const tempResults = Array.from(document.querySelectorAll('.accordion .accordion-item')).map(item => {
            const algorithm = item.querySelector('.accordion-button').textContent.trim();
            const rows = item.querySelectorAll('tbody tr');
            const data = Array.from(rows).map(row => {
                const columns = row.querySelectorAll('td');
                return columns.length > 0 ? columns[2].innerText : null;
            }).filter(item => item !== null);
    
            return { algorithm, data };
        });
    
        const datosOrdenadosPorAlgoritmo = {};
        tempResults.forEach(result => {
            const tiempo = document.querySelector(`#heading-${result.algorithm.replace(/\s+/g, '')} .accordion-body p span`).textContent.trim();
            datosOrdenadosPorAlgoritmo[result.algorithm] = { datos: result.data, tiempo: tiempo };
        });
    
        fetch('/descargar/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({ datos_ordenados_por_algoritmo: datosOrdenadosPorAlgoritmo })
        })
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'datos_ordenados.pdf';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        })
        .catch(error => console.error('Error:', error));
    });
    
        
    </script>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
